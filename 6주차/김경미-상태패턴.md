# ch10.ê°ì²´ì˜ ìƒíƒœ ë°”ê¾¸ê¸° - ìƒíƒœ íŒ¨í„´

- ëª¨ë“  ìƒíƒœë¥¼ ê°ì²´í™” í•˜ê¸°


## Context ê°ì²´ì˜ ì—­í• 
- ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í• 
- ìƒíƒœì— ë”°ë¥¸ í–‰ë™ì„ ìˆ˜í–‰
- ìƒíƒœ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬
- ìƒíƒœ ì „í™˜ì„ ê´€ë¦¬


```
public class GumballMachine {
    // ëª¨ë“  ìƒíƒœë¥¼ ê°ì²´í™”
	State soldOutState;
	State noQuarterState;
	State hasQuarterState;
	State soldState;
	State winnerState;
 
	State state = soldOutState;
	int count = 0;
 
	public GumballMachine(int numberGumballs) {
		soldOutState = new SoldOutState(this);
		noQuarterState = new NoQuarterState(this);
		hasQuarterState = new HasQuarterState(this);
		soldState = new SoldState(this);
		winnerState = new WinnerState(this);

		this.count = numberGumballs;
 		if (numberGumballs > 0) {
			state = noQuarterState;
		} 
	}
 
	public void insertQuarter() {
		state.insertQuarter();
	}
 
	public void ejectQuarter() {
		state.ejectQuarter();
	}
 
	public void turnCrank() {
		state.turnCrank();
		state.dispense();
	}

	void setState(State state) {
		this.state = state;
	}
 
	void releaseBall() {
		System.out.println("A gumball comes rolling out the slot...");
		if (count != 0) {
			count = count - 1;
		}

		if (count == 0) {
			state =  soldOutState;  // ìƒíƒœ ì „í™˜ì´ ê³ ì •ë˜ì–´ ìˆì–´ Contextì—ì„œ ì²˜ë¦¬
		} else {
			state = noQuarterState;
		}
	}
 
	int getCount() {
		return count;
	}
 
	void refill(int count) {
		this.count = count;
		state = noQuarterState;
	}

    public State getState() {
        return state;
    }

    public State getSoldOutState() {
        return soldOutState;
    }

    public State getNoQuarterState() {
        return noQuarterState;
    }

    public State getHasQuarterState() {
        return hasQuarterState;
    }

    public State getSoldState() {
        return soldState;
    }

    public State getWinnerState() {
        return winnerState;
    }
 
	public String toString() {
		StringBuffer result = new StringBuffer();
		result.append("\nMighty Gumball, Inc.");
		result.append("\nJava-enabled Standing Gumball Model #2004");
		result.append("\nInventory: " + count + " gumball");
		if (count != 1) {
			result.append("s");
		}
		result.append("\n");
		result.append("Machine is " + state + "\n");
		return result.toString();
	}
}
```

## ìƒíƒœ
<img src="https://github.com/user-attachments/assets/8e1f622d-e328-4e07-b81e-c313a0974a89" style="width:400px; height:300px;"/>

```
public interface State {
	// ë™ì „ì´ ë“¤ì–´ì˜¬ ë•Œ í•  ì¼ 
	public void insertQuarter();
	// ë™ì „ì„ ë°˜í™˜í•  ë•Œ í•´ì•¼í•  ì¼
	public void ejectQuarter();
	// ì†ì¡ì´ê°€ ëŒì•„ê°”ì„ ë•Œ í•´ì•¼í•  ì¼
	public void turnCrank();
	// ì•Œë§¹ì´ë¥¼ ë‚´ë³´ë‚¼ ë•Œ í•´ì•¼í•  ì¼
	public void dispense();
}
```

```
public class SoldState implements State {
    GumballMachine gumballMachine;
 
    public SoldState(GumballMachine gumballMachine) {
        this.gumballMachine = gumballMachine;
    }
       
	public void insertQuarter() {
		System.out.println("Please wait, we're already giving you a gumball");
	}
 
	public void ejectQuarter() {
		System.out.println("Sorry, you already turned the crank");
	}
 
	public void turnCrank() {
		System.out.println("Turning twice doesn't get you another gumball!");
	}
 
	public void dispense() {
		// ìƒíƒœ ì „í™˜ ë¡œì§ì„ ë‚´ë¶€ì—ì„œ ê´€ë¦¬
		// ë™ì ìœ¼ë¡œ ìƒíƒœë¥¼ ê²°ì •
		gumballMachine.releaseBall();
		if (gumballMachine.getCount() > 0) {
			gumballMachine.setState(gumballMachine.getNoQuarterState());
		} else {
			System.out.println("Oops, out of gumballs!");
			gumballMachine.setState(gumballMachine.getSoldOutState());
		}
	}
 
	public String toString() {
		return "dispensing a gumball";
	}
}
```
```
public class SoldOutState implements State {
    GumballMachine gumballMachine;
 
    public SoldOutState(GumballMachine gumballMachine) {
        this.gumballMachine = gumballMachine;
    }
 
	public void insertQuarter() {
		System.out.println("You can't insert a quarter, the machine is sold out");
	}
 
	public void ejectQuarter() {
		System.out.println("You can't eject, you haven't inserted a quarter yet");
	}
 
	public void turnCrank() {
		System.out.println("You turned, but there are no gumballs");
	}
 
	public void dispense() {
		System.out.println("No gumball dispensed");
	}
 
	public String toString() {
		return "sold out";
	}
}
```

```
public class NoQuarterState implements State {
    GumballMachine gumballMachine;
 
    public NoQuarterState(GumballMachine gumballMachine) {
        this.gumballMachine = gumballMachine;
    }
 
	public void insertQuarter() {
		System.out.println("You inserted a quarter");
		gumballMachine.setState(gumballMachine.getHasQuarterState());
	}
 
	public void ejectQuarter() {
		System.out.println("You haven't inserted a quarter");
	}
 
	public void turnCrank() {
		System.out.println("You turned, but there's no quarter");
	 }
 
	public void dispense() {
		System.out.println("You need to pay first");
	} 
 
	public String toString() {
		return "waiting for quarter";
	}
}
```

```
public class HasQuarterState implements State {
	Random randomWinner = new Random(System.currentTimeMillis());
	GumballMachine gumballMachine;
 
	public HasQuarterState(GumballMachine gumballMachine) {
		this.gumballMachine = gumballMachine;
	}
  
	public void insertQuarter() {
		System.out.println("You can't insert another quarter");
	}
 
	public void ejectQuarter() {
		System.out.println("Quarter returned");
		gumballMachine.setState(gumballMachine.getNoQuarterState());
	}
 
	public void turnCrank() {
		System.out.println("You turned...");
		int winner = randomWinner.nextInt(10);
		if ((winner == 0) && (gumballMachine.getCount() > 1)) {
			gumballMachine.setState(gumballMachine.getWinnerState());
		} else {
			gumballMachine.setState(gumballMachine.getSoldState());
		}
	}

    public void dispense() {
        System.out.println("No gumball dispensed");
    }
 
	public String toString() {
		return "waiting for turn of crank";
	}
}
```


## ìƒíƒœ íŒ¨í„´(State Pattern)
ìƒíƒœ íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´ ê°ì²´ì˜ ë‚´ë¶€ ìƒíƒœê°€ ë°”ë€œì— ë”°ë¼ì„œ ê°ì²´ì˜ í–‰ë™ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤. ë§ˆì¹˜ ê°ì²´ì˜ í´ë˜ìŠ¤ê°€ ë°”ë€ŒëŠ” ê²ƒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.


### Q1. Context ìƒíƒœ ì „í™˜ì„ ì–´ë””ì„œ í• ê¹Œ?
- ë™ì ìœ¼ë¡œ ìƒíƒœê°€ ë³€í•˜ëŠ” ê²½ìš°ì—ëŠ” ìƒíƒœ í´ë˜ìŠ¤ì—ì„œ ìƒíƒœ ì „í™˜ì„ ê´€ë¦¬í•˜ëŠ” ê²Œ ìœ ë¦¬
- ìƒíƒœ ì „í™˜ì´ ê³ ì •ëœ ê²½ìš°ëŠ” Contextì—ì„œ ìƒíƒœ ì „í™˜

### Q2. ìƒíƒœ í´ë˜ìŠ¤ ì‚¬ì´ì˜ ì˜ì¡´ì„± ë¬¸ì œ
```
// ìƒíƒœ í´ë˜ìŠ¤ ê°„ ì§ì ‘ ì°¸ì¡° (ì˜ì¡´ì„± ì¦ê°€)
gumballMachine.setState(new SoldState());
gumballMachine.setState(new WinnerState());
```

Contextì˜ ê²Œí„° ë©”ì„œë“œë¡œ ì˜ì¡´ì„± ìµœì†Œí™”

```
// ìƒíƒœ í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ Contextë¥¼ í†µí•´ ìƒíƒœë¥¼ ê°€ì ¸ì˜´
gumballMachine.setState(gumballMachine.getWinnerState());
gumballMachine.setState(gumballMachine.getSoldState());
```

- ìƒíƒœ í´ë˜ìŠ¤ì—ì„œ ë‹¤ë¥¸ ìƒíƒœ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ newë¡œ ìƒì„±í•˜ë©´ ìƒíƒœ í´ë˜ìŠ¤ ê°„ ê°•í•œ ê²°í•©ì´ ìƒê¸´ë‹¤.

- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Contextì˜ ê²Œí„° ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœ í´ë˜ìŠ¤ë¥¼ ê°„ì ‘ ì°¸ì¡°í•˜ë©´, ìƒíƒœ ì¶”ê°€ë‚˜ ìˆ˜ì • ì‹œ ì½”ë“œ ìˆ˜ì • ë²”ìœ„ë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆë‹¤.


## ìƒíƒœ íŒ¨í„´ (State Pattern)ê³¼ ì „ëµ íŒ¨í„´ (Strategy Pattern)ì˜ ì°¨ì´

ìƒíƒœ íŒ¨í„´ê³¼ ì „ëµ íŒ¨í„´ì€ êµ¬ì¡°ê°€ ë¹„ìŠ·í•˜ì§€ë§Œ, ëª©ì ê³¼ í™œìš© ë°©ì‹ì—ì„œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤. 

| êµ¬ë¶„           | ì „ëµ íŒ¨í„´ (Strategy Pattern)                          | ìƒíƒœ íŒ¨í„´ (State Pattern)                             |
|---------------|--------------------------------------------------------|--------------------------------------------------------|
| **ëª©ì **      | ë™ì¼í•œ ì‘ì—…ì„ **ë‹¤ë¥¸ ë°©ì‹**ìœ¼ë¡œ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©           | **ìƒíƒœ ë³€í™”**ì— ë”°ë¼ í–‰ë™ì´ ë‹¬ë¼ì§ˆ ë•Œ ì‚¬ìš©               |
| **ì‚¬ìš© ì‚¬ë¡€**  | ì •ë ¬ ì•Œê³ ë¦¬ì¦˜ êµì²´, ê²°ì œ ìˆ˜ë‹¨ ë³€ê²½                       | ìíŒê¸° ìƒíƒœ ê´€ë¦¬, ìŒì•… í”Œë ˆì´ì–´ ìƒíƒœ ì „í™˜                |
| **êµ¬ì¡°ì  íŠ¹ì§•**| **í–‰ë™ì„ ìº¡ìŠí™”í•˜ì—¬ êµì²´ ê°€ëŠ¥**                        | **ìƒíƒœë¥¼ ìº¡ìŠí™”í•˜ì—¬ ë™ì‘ ë³€ê²½**                          |
| **í–‰ë™ ë³€í™”**  | **ì™¸ë¶€ ì„¤ì •**ì— ë”°ë¼ í–‰ë™ì´ ë°”ë€œ                        | **ë‚´ë¶€ ìƒíƒœ**ì— ë”°ë¼ í–‰ë™ì´ ë°”ë€œ                         |
| **ì»¨í…ìŠ¤íŠ¸ ì—­í• ** | í–‰ë™ì„ **ìœ„ì„**í•˜ì—¬ ì‚¬ìš©                                | í˜„ì¬ ìƒíƒœë¥¼ **ê´€ë¦¬**í•˜ê³  ì „í™˜                            |
| **ìœ ì—°ì„±**     | ìƒˆë¡œìš´ ì „ëµ ì¶”ê°€ê°€ ìš©ì´                                 | ìƒˆë¡œìš´ ìƒíƒœ ì¶”ê°€ê°€ ìš©ì´                                 |

---

### ğŸ’¡ í•œ ì¤„ ìš”ì•½
- **ì „ëµ íŒ¨í„´**: **ê°™ì€ ì‘ì—…ì„ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ** ì²˜ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ. (í–‰ë™ì´ ì¤‘ìš”)  
- **ìƒíƒœ íŒ¨í„´**: **ìƒíƒœì— ë”°ë¼ ë™ì‘ì´ ë°”ë€Œì–´ì•¼** í•  ë•Œ. (ìƒíƒœê°€ ì¤‘ìš”)  

ë‘˜ ë‹¤ **í–‰ë™ì„ ìº¡ìŠí™”**í•˜ì§€ë§Œ,  
- ì „ëµ íŒ¨í„´ì€ **í–‰ë™ êµì²´**ì— ì¤‘ì ,  
- ìƒíƒœ íŒ¨í„´ì€ **ìƒíƒœ ë³€í™”**ì— ì¤‘ì !